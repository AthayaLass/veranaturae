<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator - Veranaturae</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .size-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .size-control {
            flex: 1;
        }

        .size-control input[type="range"] {
            width: 100%;
            margin-top: 5px;
        }

        .size-value {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }

        .customization-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #f0f0f0;
        }

        .customization-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            cursor: pointer;
            user-select: none;
        }

        .customization-toggle h3 {
            margin: 0;
            color: #333;
            font-size: 16px;
        }

        .customization-content {
            display: none;
            margin-top: 15px;
        }

        .customization-content.active {
            display: block;
        }

        .color-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .color-input-wrapper {
            flex: 1;
        }

        .color-input-wrapper label {
            font-size: 12px;
        }

        input[type="color"] {
            width: 100%;
            height: 45px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            padding: 2px;
        }

        input[type="file"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .logo-preview {
            width: 100%;
            max-width: 100px;
            height: 100px;
            object-fit: contain;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }

        .logo-preview.show {
            display: block;
        }

        .logo-size-control {
            margin-top: 10px;
        }

        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .remove-logo-btn {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            font-size: 14px;
            margin-top: 10px;
        }

        .remove-logo-btn:hover {
            background: #c82333;
        }

        .qr-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 250px;
            align-items: center;
        }

        #qrcode {
            display: inline-block;
        }

        #qrcode img {
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-download {
            background: #28a745;
            color: white;
        }

        .btn-download:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-download:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .info {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
            font-size: 13px;
            color: #1976D2;
        }

        .info strong {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QR Code Generator</h1>
        <p class="subtitle">Create QR codes for free - no subscription needed!</p>
        
        <div class="input-group">
            <label for="urlInput">Website URL:</label>
            <input type="text" id="urlInput" value="https://veranaturae.ch/" placeholder="Enter URL here">
        </div>

        <div class="size-controls">
            <div class="size-control">
                <label for="sizeSlider">Size: <span id="sizeValue">300</span>px</label>
                <input type="range" id="sizeSlider" min="200" max="500" value="300">
            </div>
        </div>

        <div class="customization-section">
            <div class="customization-toggle" onclick="toggleCustomization()">
                <h3>ðŸŽ¨ Customization Options</h3>
                <span id="toggleIcon">â–¼</span>
            </div>
            <div class="customization-content" id="customizationContent">
                <div class="color-group">
                    <div class="color-input-wrapper">
                        <label for="foregroundColor">Foreground Color:</label>
                        <input type="color" id="foregroundColor" value="#000000">
                    </div>
                    <div class="color-input-wrapper">
                        <label for="backgroundColor">Background Color:</label>
                        <input type="color" id="backgroundColor" value="#FFFFFF">
                    </div>
                </div>

                <div class="input-group">
                    <label for="errorCorrection">Error Correction Level:</label>
                    <select id="errorCorrection">
                        <option value="L">L - Low (~7% damage tolerance)</option>
                        <option value="M" selected>M - Medium (~15% damage tolerance)</option>
                        <option value="Q">Q - Quartile (~25% damage tolerance)</option>
                        <option value="H">H - High (~30% damage tolerance)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="dotShape">Dot Shape:</label>
                    <select id="dotShape">
                        <option value="square" selected>Square</option>
                        <option value="rounded">Rounded</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="logoUpload">Add Logo (optional):</label>
                    <input type="file" id="logoUpload" accept="image/*">
                    <img id="logoPreview" class="logo-preview" alt="Logo preview">
                    <div class="logo-size-control">
                        <label for="logoSize">Logo Size: <span id="logoSizeValue">20</span>%</label>
                        <input type="range" id="logoSize" min="10" max="30" value="20">
                    </div>
                    <button class="remove-logo-btn" id="removeLogoBtn" onclick="removeLogo()" style="display: none;">Remove Logo</button>
                </div>
            </div>
        </div>

        <button class="btn-generate" onclick="generateQR()">Generate QR Code</button>

        <div class="qr-container">
            <div id="qrcode"></div>
        </div>

        <div class="button-group">
            <button class="btn-download" id="downloadBtn" onclick="downloadQR()" disabled>Download QR Code</button>
        </div>

        <div class="info">
            <strong>ðŸ’¡ Tip:</strong>
            This tool is completely free and works offline once loaded. The QR code will work forever as long as your URL stays the same!
        </div>
    </div>

    <!-- QRCode.js library - completely free and open source -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <script>
        let currentQRCodeDataURL = null;
        let logoImage = null;

        // Toggle customization panel
        function toggleCustomization() {
            const content = document.getElementById('customizationContent');
            const icon = document.getElementById('toggleIcon');
            content.classList.toggle('active');
            icon.textContent = content.classList.contains('active') ? 'â–²' : 'â–¼';
        }

        // Update size display
        document.getElementById('sizeSlider').addEventListener('input', function(e) {
            document.getElementById('sizeValue').textContent = e.target.value;
        });

        // Update logo size display
        document.getElementById('logoSize').addEventListener('input', function(e) {
            document.getElementById('logoSizeValue').textContent = e.target.value;
        });

        // Handle logo upload
        document.getElementById('logoUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    logoImage = new Image();
                    logoImage.src = event.target.result;
                    logoImage.onload = function() {
                        document.getElementById('logoPreview').src = event.target.result;
                        document.getElementById('logoPreview').classList.add('show');
                        document.getElementById('removeLogoBtn').style.display = 'block';
                    };
                };
                reader.readAsDataURL(file);
            }
        });

        // Remove logo
        function removeLogo() {
            logoImage = null;
            document.getElementById('logoUpload').value = '';
            document.getElementById('logoPreview').src = '';
            document.getElementById('logoPreview').classList.remove('show');
            document.getElementById('removeLogoBtn').style.display = 'none';
        }

        // Generate QR code with customization
        function generateQR() {
            const url = document.getElementById('urlInput').value.trim();
            const size = parseInt(document.getElementById('sizeSlider').value);
            const foregroundColor = document.getElementById('foregroundColor').value;
            const backgroundColor = document.getElementById('backgroundColor').value;
            const errorCorrection = document.getElementById('errorCorrection').value;
            const dotShape = document.getElementById('dotShape').value;

            if (!url) {
                alert('Please enter a URL');
                return;
            }

            // Validate URL
            let validUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                validUrl = 'https://' + url;
            }

            const qrcodeDiv = document.getElementById('qrcode');
            qrcodeDiv.innerHTML = ''; // Clear previous QR code

            // Generate QR code
            QRCode.toCanvas(validUrl, {
                width: size,
                margin: 2,
                color: {
                    dark: foregroundColor,
                    light: backgroundColor
                },
                errorCorrectionLevel: errorCorrection
            }, function (err, canvas) {
                if (err) {
                    console.error(err);
                    alert('Error generating QR code. Please try again.');
                    return;
                }

                // Apply rounded corners if selected
                if (dotShape === 'rounded') {
                    applyRoundedCorners(canvas);
                }

                // Add logo if provided
                if (logoImage) {
                    addLogoToQR(canvas, logoImage);
                }

                // Convert canvas to data URL
                const dataURL = canvas.toDataURL('image/png');

                // Display QR code
                const img = document.createElement('img');
                img.src = dataURL;
                img.alt = 'QR Code';
                qrcodeDiv.appendChild(img);

                // Store for download
                currentQRCodeDataURL = dataURL;
                document.getElementById('downloadBtn').disabled = false;
            });
        }

        // Apply rounded corners to QR code
        function applyRoundedCorners(canvas) {
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const radius = 2; // Corner radius in pixels

            // Create a temporary canvas for rounded corners
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Set background
            tempCtx.fillStyle = '#FFFFFF';
            tempCtx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw rounded rectangles for dark pixels
            const pixelSize = 1;
            for (let y = 0; y < canvas.height; y++) {
                for (let x = 0; x < canvas.width; x++) {
                    const index = (y * canvas.width + x) * 4;
                    const r = data[index];
                    const g = data[index + 1];
                    const b = data[index + 2];
                    
                    // Check if pixel is dark (foreground)
                    if (r < 128 || g < 128 || b < 128) {
                        tempCtx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                        tempCtx.beginPath();
                        // Draw rounded rectangle
                        const xPos = x;
                        const yPos = y;
                        tempCtx.moveTo(xPos + radius, yPos);
                        tempCtx.lineTo(xPos + pixelSize - radius, yPos);
                        tempCtx.quadraticCurveTo(xPos + pixelSize, yPos, xPos + pixelSize, yPos + radius);
                        tempCtx.lineTo(xPos + pixelSize, yPos + pixelSize - radius);
                        tempCtx.quadraticCurveTo(xPos + pixelSize, yPos + pixelSize, xPos + pixelSize - radius, yPos + pixelSize);
                        tempCtx.lineTo(xPos + radius, yPos + pixelSize);
                        tempCtx.quadraticCurveTo(xPos, yPos + pixelSize, xPos, yPos + pixelSize - radius);
                        tempCtx.lineTo(xPos, yPos + radius);
                        tempCtx.quadraticCurveTo(xPos, yPos, xPos + radius, yPos);
                        tempCtx.closePath();
                        tempCtx.fill();
                    }
                }
            }

            // Copy back to original canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(tempCanvas, 0, 0);
        }

        // Add logo to center of QR code
        function addLogoToQR(canvas, logo) {
            const ctx = canvas.getContext('2d');
            const logoSizePercent = parseInt(document.getElementById('logoSize').value);
            const logoSize = (canvas.width * logoSizePercent) / 100;
            
            // Calculate center position
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const logoX = centerX - logoSize / 2;
            const logoY = centerY - logoSize / 2;

            // Draw white background for logo
            const padding = logoSize * 0.1;
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(logoX - padding, logoY - padding, logoSize + padding * 2, logoSize + padding * 2);

            // Draw logo
            ctx.drawImage(logo, logoX, logoY, logoSize, logoSize);
        }

        // Download QR code
        function downloadQR() {
            if (!currentQRCodeDataURL) {
                alert('Please generate a QR code first');
                return;
            }

            const url = document.getElementById('urlInput').value.trim();
            let filename = 'qrcode.png';
            
            try {
                // Try to extract domain name for filename
                const urlObj = new URL(url.startsWith('http') ? url : 'https://' + url);
                filename = `qrcode-${urlObj.hostname.replace(/\./g, '-')}.png`;
            } catch (e) {
                // If URL parsing fails, use default name
            }

            // Create download link
            const link = document.createElement('a');
            link.download = filename;
            link.href = currentQRCodeDataURL;
            link.click();
        }

        // Generate QR code on Enter key
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateQR();
            }
        });

        // Auto-generate on page load with default URL
        window.addEventListener('load', function() {
            generateQR();
        });
    </script>
</body>
</html>

